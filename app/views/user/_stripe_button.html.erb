
<%= form_tag charges_path, id: 'stripeForm' do %>
  <%= hidden_field_tag :subcription_user_id, @user.id %>
  <%= hidden_field_tag :price, @user.price %>
  <%= hidden_field_tag :stripeToken, id: 'stripeToken' %>
  <%= link_to 'View lineups for today', '#', id: 'customButton', class: 'btn btn-success' %>

  <script src="https://checkout.stripe.com/checkout.js"></script>

  <script>
    var handler = stripecheckout.configure({
      key: '<%= rails.configuration.stripe[:publishable_key] %>',
      image: 'http://i.imgur.com/hpl8vld.png',
      token: function(token) {
        // use the token to create the charge with a server-side script.
        // you can access the token id with `token.id`
        $('#stripetoken').val(token.id);
        $('#stripeform').submit();
      }
    });

    $('#custombutton').on('click', function(e) {
      // open checkout with further options
      handler.open({
        name: 'fanalyst',
        description: '12 hours of full access.',
        amount: <%= (@user.price.round(2)*100).to_i %>
      });
      e.preventdefault();
    });

    // close checkout on page navigation
    $(window).on('popstate', function() {
      handler.close();
    });
  </script>

<% end %>

